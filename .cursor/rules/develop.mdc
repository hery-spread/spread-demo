---
description: 
globs: 
alwaysApply: true
---
Travaille DRY et KISS, avant de commencer analyse la tâche, effectue une analyse de l'architecture actuelle, puis analyse dans le chat l'User Story en détails et en quoi cela changera l'architecture, si tu as les autres user stories avec toi, analyse les implications futures de tes modifications dans l'implémentation, puis crée un fichier dans le dossier TODO sous forme suivante : TODO/TODO_{code user_story}.MD comprenant la liste des choses à faire pour cette user Story. Lis les fichiers TODO déjà existants ainsi que l’historique des modifications pour détecter si des tâches similaires ont déjà été abordées ou si des décisions antérieures influencent ton implémentation. Avant d’initier la moindre ligne de code, analyse les fichiers de migration existants s’ils sont présents, pour détecter d’éventuels changements de structure ou d’intention dans le schéma de base de données. Toute modification impactant la DB doit faire l’objet d’un scan préalable des migrations pour éviter les conflits, doublons ou comportements inattendus.

Lorsque la structure de la base de données est modifiée, déclenche immédiatement une commande npx supabase gen types typescript --project-id tjxkquzguhbbqyoumdom --schema public > src/lib/types/database-generated.ts pour régénérer automatiquement les types Typescript à jour.

Considère toujours que la base Supabase est en Cloud (jamais en local). Tout comportement, configuration ou accès doit être aligné avec cette contrainte.

Lors de toute interaction avec la DB, privilégie les types natifs exposés par Supabase (uuid, jsonb, timestamp with time zone, etc.) plutôt que des types abstraits manuellement ou des conversions inutiles dans le code client. Cela garantit la robustesse, la cohérence et la synchronisation automatique des types.

Déduis automatiquement les patterns déjà utilisés dans le projet pour t’y conformer, dans une logique DRY et KISS. Avant d’écrire du code, initie une étape de questionnement et de clarification dans le chat avec l’utilisateur : résume en une ou deux phrases l’User Story, identifie les zones de code concernées, pointe les dépendances croisées et les éventuels pièges, puis propose ton plan de modification. Si l’utilisateur valide ce plan, commence l’implémentation. Pour chaque User Story, crée un fichier de todo structuré dans TODO/TODO_{code_user_story}.MD, contenant une checklist claire, concise et exhaustive des actions à mener : fichiers à modifier, nouvelles classes à créer, tests à écrire ou à adapter, migrations à générer ou à relire, endpoints à exposer ou à sécuriser, ainsi que les validations à effectuer (techniques ou fonctionnelles). À chaque instant, indique clairement dans le chat dans quelle étape du fichier TODO tu te trouves (ex : [étape 3/7] - Création du composant UI), et dès qu’une étape est terminée, coche-la directement dans le fichier TODO. Chaque étape validée doit être automatiquement cochée dans le fichier au fur et à mesure de l'avancement, et chaque modification effective doit être horodatée et enregistrée dans un fichier de log de type history.md (ou appendée dans un CHANGELOG.md) avec la référence de l’User Story, la description de la modification et la liste des fichiers modifiés. Toujours rechercher la cohérence avec les évolutions futures connues : si d’autres User Stories sont présentes dans les fichiers, les charger et les analyser automatiquement pour anticiper les impacts et éviter les refactorings inutiles. Si plusieurs tâches semblent en conflit ou en redondance, remonter l’alerte dans le chat avec une proposition de résolution. Tu dois être en capacité de geler temporairement une tâche si elle dépend logiquement d’une autre non encore traitée. Le système doit également s’assurer qu’aucune modification sensible (logique métier critique, suppression de données, refactor majeur, changement de signature publique) ne soit lancée sans validation manuelle explicite de l’utilisateur. Lorsqu’une action est marquée comme critique, afficher dans le chat un récapitulatif des risques et une demande de confirmation. Avant toute création de composant ou de modification d’interface, analyser systématiquement la charte graphique et le design system décrits dans le dossier DESIGN. Vérifier si un composant équivalent n’existe pas déjà pour éviter toute duplication. Si un composant similaire est présent, l’adapter plutôt que de le réécrire, en respectant les conventions de style, de nommage et de structure. Tout nouveau composant doit être cohérent visuellement, techniquement et structurellement avec les composants existants. En résumé : analyse, projette, propose, valide, trace, reste aligné au design system, indique à tout moment ta progression, et coche au fur et à mesure les tâches accomplies.

N'oublie pas le fonctionnement d'une User Story : à la fin de ta réponse, tout doit être fait, puis tu dois résoudre les erreurs de lint ainsi que les erreurs de build. Sauf si c'est demandé explicitement, rien ne doit être mocké, uniquement de vraies données. On n'utilise pas Supabase Local mais Supabase Cloud. Toutes les migrations doivent porter un nom cohérent compte tenu des migrations précédentes.