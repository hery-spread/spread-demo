# PLAN D'ACTION PRESCRIPTIF : LISTS-07 â€” Liste automatique Â« Rapports d'audience dÃ©bloquÃ©s Â» (UI distincte)

## User Story

En tant qu'utilisateur, je veux une liste automatique par dÃ©faut qui regroupe tous mes rapports d'audience dÃ©jÃ  dÃ©bloquÃ©s, visible dans Â« Mes Listes Â», avec une apparence visuelle distincte et des actions dÃ©diÃ©es (refresh en masse / unitaire), afin d'y accÃ©der rapidement sans configuration.

---

## Contexte & dÃ©pendances

- DonnÃ©es existantes (mock): `mockUnlockedReports`, `getUnlockedReports`, `refreshReport`, `refreshMultipleReports`, `getRefreshStats` dans `src/lib/mockData.ts`.
- Types: `UnlockedReport`, `RefreshStats` dans `src/types/index.ts`.
- UI de listes existante: `src/app/lists/page.tsx`, `src/app/lists/[id]/page.tsx`, composants sous `src/components/lists/*`.
- Ã€ terme (prod): source Supabase/Modash (non inclus ici). Garder lâ€™API interne agnostique pour remplacer facilement la source de donnÃ©es.

---

## Objectifs

1. Enregistrer une Â« liste systÃ¨me Â» par dÃ©faut: Â« Rapports dÃ©bloquÃ©s Â» (non supprimable, toujours visible).
2. UI diffÃ©renciÃ©e: badge Â« Automatique Â», icÃ´ne/un style distinct, bandeau dâ€™explication.
3. Page de dÃ©tail dÃ©diÃ©e: colonnes pertinentes + actions de rafraÃ®chissement (unitaire et masse) + indicateurs dâ€™Ã©tat.
4. Filtrage/tri basiques: par plateforme, date de dÃ©blocage, statut fraÃ®cheur.

---

## PortÃ©e technique

- Routing & dÃ©tection liste systÃ¨me:
  - Utiliser un `systemId` stable: `system-unlocked-reports`.
  - Lister cette entrÃ©e dans `src/app/lists/page.tsx` en tÃªte de section.
  - Dans `src/app/lists/[id]/page.tsx`, si `id === 'system-unlocked-reports'`, rendre un composant spÃ©cialisÃ©.
- Nouveau composant: `src/components/lists/UnlockedReportsList.tsx` (table + actions + bandeau).
- Services: `src/lib/unlockedReports.ts` (faÃ§ade) qui wrap les fonctions mock (`getUnlockedReports`, `refreshReport`, `refreshMultipleReports`, `getRefreshStats`) pour dÃ©coupler lâ€™UI de la source.
- Types/UI: rÃ©utiliser `UnlockedReport` et introduire un type de vue enrichi si nÃ©cessaire: rapport + infos influenceur ramenÃ©es depuis les mocks existants.

---

## Plan d'Action Prescriptif

### Ã‰tape 1 â€” FaÃ§ade data

- [ ] CrÃ©er `src/lib/unlockedReports.ts` avec:
  - [ ] `listUnlockedReports(): Promise<UnlockedReport[]>`
  - [ ] `refreshOne(reportId: string): Promise<UnlockedReport>`
  - [ ] `refreshMany(reportIds: string[]): Promise<{ updated: number }>`
  - [ ] `getStats(): Promise<RefreshStats>`
  - [ ] Optionnel: `hydrateWithInfluencer(report)` pour joindre nom, avatar, plateforme.

### Ã‰tape 2 â€” Enregistrement de la Â« liste systÃ¨me Â»

- [ ] Modifier `src/app/lists/page.tsx` pour injecter une Card spÃ©ciale en tÃªte:
  - Titre: Â« Rapports d'audience dÃ©bloquÃ©s Â»
  - Badge: Â« Automatique Â»
  - IcÃ´ne: lock-open/bolt (consistant avec le design system)
  - CTA: Â« Ouvrir Â» â†’ `/lists/system-unlocked-reports`

### Ã‰tape 3 â€” DÃ©tail de la liste systÃ¨me

- [ ] CrÃ©er `src/components/lists/UnlockedReportsList.tsx`:
  - Bandeau dâ€™info (diffÃ©renciation UI): Cette liste se met Ã  jour automatiquement.
  - Boutons: Â« RafraÃ®chir la sÃ©lection Â», Â« RafraÃ®chir tout Â» (+ compteur et feedback).
  - Table colonnes: Profil, Plateforme, Dernier refresh, Statut (fresh/stale), Impressions/ER (si dispo), Actions (RafraÃ®chir).
  - Filtres locaux (barre compacte): plateforme (IG/YT/TT), statut fraÃ®cheur, recherche par nom.
  - SÃ©lection multiple par checkbox.
- [ ] IntÃ©grer ce composant dans `src/app/lists/[id]/page.tsx` quand `id` vaut `system-unlocked-reports`.

### Ã‰tape 4 â€” UI distincte

- [ ] Style diffÃ©rent de `ListCard` standard: cadre accentuÃ©, badge Â« Automatique Â», fond subtil, icÃ´ne dÃ©diÃ©e.
- [ ] Empty state dÃ©diÃ©: Â« Aucun rapport dÃ©bloquÃ© pour le moment Â» + lien contextuel vers les zones oÃ¹ dÃ©bloquer.

### Ã‰tape 5 â€” QA & perf

- [ ] GÃ©rer les Ã©tats de chargement/erreur sur les refresh.
- [ ] Optimiser les updates UI (optimistic update + rollback en cas dâ€™Ã©chec).
- [ ] `npm run lint` et `npm run build` â†’ OK.

---

## CritÃ¨res d'acceptation

- [ ] La liste Â« Rapports d'audience dÃ©bloquÃ©s Â» apparaÃ®t par dÃ©faut dans Â« Mes Listes Â» avec un style distinct et un badge Â« Automatique Â».
- [ ] La route `/lists/system-unlocked-reports` affiche la table avec colonnes, filtres, sÃ©lection multiple et actions de rafraÃ®chissement (unitaire/masse).
- [ ] Les actions de refresh mettent Ã  jour lâ€™UI (dates/statuts) et retournent un feedback utilisateur.
- [ ] Lint/Build OK.

---

## Risques & notes

- CohÃ©rence des types: ne pas diverger des interfaces existantes `UnlockedReport`/`RefreshStats`.
- Ã‰volution future: remplacer facilement la faÃ§ade mock par des appels rÃ©els (Supabase/Modash) sans toucher lâ€™UI.
- Performance: prÃ©voir pagination ou lazy load si la liste devient volumineuse.

# TODO LISTS-07 : Liste Rapports DÃ©bloquÃ©s + SystÃ¨me Refresh

## ğŸ¯ Objectif

CrÃ©er une liste spÃ©cialisÃ©e "Rapports DÃ©bloquÃ©s" permettant de visualiser et rafraÃ®chir les rapports d'audience dÃ©jÃ  dÃ©bloquÃ©s.

## ğŸ“‹ Plan d'Action Prescriptif

### Ã‰tape 1 : Extension Types et Mock Data

- [ ] Ajouter interface `UnlockedReport` dans `types/index.ts`
- [ ] CrÃ©er mock data pour rapports dÃ©bloquÃ©s dans `lib/mockData.ts`
- [ ] Ajouter fonctions CRUD pour rapports dÃ©bloquÃ©s
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 2 : Composant UnlockedReportsCard

- [ ] CrÃ©er `components/lists/UnlockedReportsCard.tsx`
- [ ] Interface spÃ©cialisÃ©e pour rapports avec actions refresh
- [ ] Boutons refresh unitaire et en masse
- [ ] Indicateurs de statut (fresh/stale/refreshing)
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 3 : Composant RefreshReportsModal

- [ ] CrÃ©er `components/lists/RefreshReportsModal.tsx`
- [ ] SÃ©lection multiple des rapports Ã  rafraÃ®chir
- [ ] Indicateur de progression du refresh
- [ ] Gestion des erreurs et succÃ¨s
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 4 : Hook useUnlockedReports

- [ ] CrÃ©er `hooks/useUnlockedReports.ts`
- [ ] Logique de rÃ©cupÃ©ration des rapports dÃ©bloquÃ©s
- [ ] Fonctions refresh unitaire et masse
- [ ] Gestion du statut de fraÃ®cheur des donnÃ©es
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 5 : IntÃ©gration Page Lists

- [ ] Modifier `app/lists/page.tsx`
- [ ] Ajouter section dÃ©diÃ©e rapports dÃ©bloquÃ©s
- [ ] Statistiques rapports dans header
- [ ] Filtrage spÃ©cifique aux rapports
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 6 : Page DÃ©tail Rapports DÃ©bloquÃ©s

- [ ] CrÃ©er `app/lists/unlocked-reports/page.tsx`
- [ ] Vue dÃ©taillÃ©e de tous les rapports
- [ ] Interface de gestion avancÃ©e
- [ ] Analytics et mÃ©triques des rafraÃ®chissements
- [ ] Test : `npm run build` & `npm run lint`

### Ã‰tape 7 : Tests et IntÃ©gration Finale

- [ ] VÃ©rifier cohÃ©rence design system
- [ ] Tests d'interaction utilisateur
- [ ] Optimisation performances
- [ ] Test final : `npm run build` & `npm run lint`

## ğŸ¨ Design System

- Respecter palette couleurs existante (violet/purple theme)
- IcÃ´nes : DocumentCheckIcon, ArrowPathIcon pour refresh
- States visuels : fresh (vert), stale (orange), refreshing (bleu)
- Animations subtiles pour feedback utilisateur

## âœ… CritÃ¨res de Validation

- Liste "Rapports DÃ©bloquÃ©s" accessible depuis /lists
- Refresh unitaire et en masse fonctionnels
- Indicateurs de statut clairs
- Performance optimale (pas de lag)
- CohÃ©rence totale avec design existant
- Aucune erreur build/lint

## ğŸš¨ Attention

- S'assurer de la cohÃ©rence avec logique UnlockReportsModal existante
- PrÃ©voir gestion des rapports expirÃ©s/pÃ©rimÃ©s
- Optimiser pour Ã©viter spam des API de refresh
